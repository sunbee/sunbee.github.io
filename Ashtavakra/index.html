<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="/Styles/main.css">
  <title>Slideshow SPA</title>
  </script>
</head>

<body>
    <script>
        class Observable {
            constructor(value) {
                this._value = value;
                this._listeners = [];   
            }

            subscribe(listener) {
                this._listeners.push(listener);
            }

            notify() {
                this._listeners.forEach(listener => listener(this._value));
            }

            get value() {
                return this._value;
            }

            set value(val) {
                if (this._value != val) {
                this._value = val;
                this.notify();
                }
            }
        } 

        class Computed extends Observable {
            constructor (computer, dependents) {
                super(computer());	// Initialize computed value 
                                    // by call to constructor of Observable class
                const listener = (_) => {
                    /*
                    Helper function, corrals all dependents 
                    (which are Observable instances,) and 
                    recomputes the computed value, then
                    notifies any listeners.
                    Note that 'listeners' property is inherited
                    from parent Observable class, hence the chaining effect.
                    */
                    console.log('Listener in Computed got ' + _);
                    this._value = computer();
                    this.notify();  // Notify listeners of 'this' instance 
                                // of Computed class

                }
                dependents.forEach(dependent => dependent.subscribe(listener));    
            }

            get value() {
                return this._value;
            }

            set value(_) {
                /*
                Raise an exception, the value is computed from dependents, 
                not set.
                */
                throw "Set no computed property.";
            }

        }

        var first_name = new Observable("Dalai");
        var second_name = new Observable("Lama");

        var full_name = new Computed(() => `HH ${first_name.value} ${second_name.value}`, [first_name, second_name]);
        full_name.subscribe((val) => console.log(`The HH changed to ${val}`)); // Chaining

        first_name.value = "Panchen";
        first_name.value = "Vishnu";
        first_name.value = "Vishnu";

        // Create an observer instance
        var observer = new MutationObserver( (mutations) => {
            mutations.forEach( (mutation) => {
                var newNodes = mutation.addedNodes; // DOM NodeList
                if(newNodes !== undefined && newNodes.length > 0) { // If there are new nodes added
                    newNodes.forEach( (newNode) => {
                        var description = "name: " + newNode.nodeName;
                        if (newNode.id) {
                            description += " | ID: " + newNode.id;
                        }
                        alert("Added: " + description);
                    });
                }
            });
            alert(document.getElementById("Expected").getAttributeNames());
        });

        // Configuration of the observer:
        var config = { 
            attributes: true, 
            childList: true, 
            subtree: true 
        };

        document.addEventListener('DOMContentLoaded', () => {
            var plug = "Howdy, WebViewer!";
            var appInventor = window.AppInventor; 
            if (appInventor) { // Do this when js is processed in AppInventor.
                plug = window.AppInventor.getWebViewString();
            } 

            // The node to be monitored
            var target = document.getElementById("Question"); /// The node to be monitored
            // Pass in the target node, as well as the observer options
            observer.observe(target, config);            

            document.getElementById("Question").innerHTML = plug;


        }); 
    </script>
    <div id="Slide">
        <div id="Header"><h1>Quiz Time!</h1></div>
        <div id="Question"></div>
        <div id="Controls"></div>
    </div>

</body>
</html>